<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cross-Device Screen Question Solver</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: white;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 15px;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.4);
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .device-indicator {
            display: inline-block;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .control-panel {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 25px;
            padding: 30px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .screen-preview {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 25px;
            padding: 30px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            text-align: center;
            color: #ffd700;
        }

        .permission-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #4CAF50;
        }

        .screen-video {
            width: 100%;
            height: 250px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            border: 2px dashed rgba(255, 255, 255, 0.3);
        }

        .preview-text {
            opacity: 0.7;
            font-size: 1.1rem;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }

        .control-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
        }

        .control-item label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .control-item input, .control-item select {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 1rem;
        }

        .control-item input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 20px;
        }

        button {
            padding: 14px 28px;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .start-btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }

        .stop-btn {
            background: linear-gradient(45deg, #f44336, #da190b);
            color: white;
            box-shadow: 0 4px 15px rgba(244, 67, 54, 0.3);
        }

        .minimize-btn {
            background: linear-gradient(45deg, #ff9800, #f57c00);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .status-indicator {
            text-align: center;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .status-inactive {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .status-active {
            background: rgba(76, 175, 80, 0.3);
            border: 2px solid #4CAF50;
            animation: pulse 2s infinite;
        }

        .status-background {
            background: rgba(255, 152, 0, 0.3);
            border: 2px solid #ff9800;
            animation: backgroundPulse 3s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @keyframes backgroundPulse {
            0%, 100% { 
                opacity: 1;
                transform: scale(1);
            }
            50% { 
                opacity: 0.8;
                transform: scale(1.02);
            }
        }

        .results-section {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 25px;
            padding: 30px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            margin-top: 20px;
        }

        .solution-item {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #4CAF50;
            animation: slideIn 0.6s ease;
            position: relative;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .solution-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 15px;
        }

        .timestamp {
            font-size: 0.9rem;
            opacity: 0.8;
            background: rgba(255, 255, 255, 0.1);
            padding: 5px 12px;
            border-radius: 15px;
        }

        .device-tag {
            font-size: 0.8rem;
            background: rgba(255, 193, 7, 0.3);
            padding: 4px 10px;
            border-radius: 12px;
            margin-left: 10px;
        }

        .detected-question {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            font-family: 'Courier New', monospace;
            border: 1px dashed rgba(255, 255, 255, 0.4);
        }

        .solution-content {
            font-size: 1.1rem;
            line-height: 1.6;
        }

        .cross-device-panel {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 25px;
            padding: 30px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            margin-top: 20px;
        }

        .device-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .device-card {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .device-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .device-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .qr-code {
            width: 100px;
            height: 100px;
            background: white;
            border-radius: 10px;
            margin: 15px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
            font-weight: bold;
        }

        .minimized-overlay {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(30, 60, 114, 0.95);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            z-index: 1000;
            min-width: 300px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .minimized-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .expand-btn {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-size: 1.2rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #4CAF50;
        }

        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(76, 175, 80, 0.9);
            color: white;
            padding: 15px 25px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
            z-index: 1001;
            animation: slideDown 0.5s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translate(-50%, -20px);
            }
            to {
                opacity: 1;
                transform: translate(-50%, 0);
            }
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }

            .controls-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🖥️ Cross-Device Screen Solver</h1>
            <p>Continuous screen capture and question solving across all your devices</p>
            <div class="device-indicator" id="deviceIndicator">
                📱 Detecting device...
            </div>
        </div>

        <div class="main-grid">
            <div class="control-panel">
                <h2 class="section-title">🎛️ Control Center</h2>
                
                <div class="permission-section">
                    <h3>📋 Screen Sharing Permission</h3>
                    <p style="margin: 10px 0; opacity: 0.9;">Grant screen capture access to start continuous monitoring</p>
                    <button id="requestPermissionBtn" class="start-btn">🔓 Request Screen Access</button>
                </div>

                <div class="controls-grid">
                    <div class="control-item">
                        <label>⏱️ Capture Interval (seconds)</label>
                        <input type="number" id="captureInterval" value="2" min="1" max="30" placeholder="2">
                    </div>
                    <div class="control-item">
                        <label>📤 Send Solutions To</label>
                        <select id="outputPlatform">
                            <option value="phone">📱 Phone</option>
                            <option value="tablet">📱 Tablet</option>
                            <option value="email">📧 Email</option>
                            <option value="discord">💬 Discord</option>
                            <option value="slack">💬 Slack</option>
                        </select>
                    </div>
                    <div class="control-item">
                        <label>🎯 Detection Sensitivity</label>
                        <select id="sensitivity">
                            <option value="high">🔍 High (All text)</option>
                            <option value="medium" selected>⚖️ Medium (Questions only)</option>
                            <option value="low">🎯 Low (Math only)</option>
                        </select>
                    </div>
                    <div class="control-item">
                        <label>📧 Notification Email</label>
                        <input type="email" id="notificationEmail" placeholder="your@email.com">
                    </div>
                </div>

                <div class="action-buttons">
                    <button id="startBtn" class="start-btn">🚀 Start Background Capture</button>
                    <button id="stopBtn" class="stop-btn" style="display: none;">⏹️ Stop</button>
                    <button id="minimizeBtn" class="minimize-btn" style="display: none;">🔽 Minimize</button>
                </div>

                <div id="statusIndicator" class="status-indicator status-inactive">
                    💤 Idle - Click "Request Screen Access" to begin
                </div>
            </div>

            <div class="screen-preview">
                <h2 class="section-title">🖥️ Live Screen Preview</h2>
                <div class="screen-video" id="screenPreview">
                    <div class="preview-text">
                        📸 Screen capture will appear here<br>
                        <small style="opacity: 0.7;">Grant permission to start preview</small>
                    </div>
                </div>
                <video id="screenVideo" autoplay playsinline style="width: 100%; height: 250px; border-radius: 15px; display: none;"></video>
            </div>
        </div>

        <div class="cross-device-panel">
            <h2 class="section-title">📱 Cross-Device Access</h2>
            <p style="text-align: center; margin-bottom: 20px; opacity: 0.9;">
                Access your solutions from any device using these methods
            </p>
            
            <div class="device-grid">
                <div class="device-card">
                    <div class="device-icon">📱</div>
                    <h3>Mobile Access</h3>
                    <div class="qr-code">QR Code</div>
                    <p>Scan to view solutions on your phone</p>
                </div>
                
                <div class="device-card">
                    <div class="device-icon">💻</div>
                    <h3>Web Dashboard</h3>
                    <div class="qr-code">Link</div>
                    <p id="deviceLink">https://solver.app/device/abc123</p>
                </div>
                
                <div class="device-card">
                    <div class="device-icon">📧</div>
                    <h3>Email Alerts</h3>
                    <div class="qr-code">📨</div>
                    <p>Get solutions sent to your email</p>
                </div>
                
                <div class="device-card">
                    <div class="device-icon">🔔</div>
                    <h3>Push Notifications</h3>
                    <div class="qr-code">🔔</div>
                    <p>Real-time alerts on all devices</p>
                </div>
            </div>
        </div>

        <div class="results-section">
            <h2 class="section-title">📋 Recent Solutions</h2>
            <div id="solutionsContainer">
                <p style="text-align: center; opacity: 0.7; padding: 40px;">
                    Solutions will appear here when questions are detected and solved
                </p>
            </div>
        </div>
    </div>

    <!-- Minimized Overlay (hidden by default) -->
    <div id="minimizedOverlay" class="minimized-overlay" style="display: none;">
        <div class="minimized-header">
            <h3>🔍 Screen Solver</h3>
            <button class="expand-btn" id="expandBtn">⬆️</button>
        </div>
        <div id="miniStatus" class="status-indicator status-background">
            🔍 Running in background...
        </div>
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-number" id="questionsFound">0</div>
                <div>Questions Found</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="solutionsSent">0</div>
                <div>Solutions Sent</div>
            </div>
        </div>
        <div style="text-align: center; margin-top: 15px;">
            <button id="miniStopBtn" class="stop-btn" style="padding: 8px 16px; font-size: 0.9rem;">⏹️ Stop</button>
        </div>
    </div>

    <canvas id="captureCanvas" style="display: none;"></canvas>

    <script>
        class CrossDeviceScreenSolver {
            constructor() {
                this.isCapturing = false;
                this.isMinimized = false;
                this.captureInterval = null;
                this.stream = null;
                this.canvas = document.getElementById('captureCanvas');
                this.ctx = this.canvas.getContext('2d');
                
                // Statistics
                this.questionsFound = 0;
                this.solutionsSent = 0;
                
                this.initializeElements();
                this.setupEventListeners();
                this.detectDevice();
                this.generateDeviceId();
            }

            initializeElements() {
                this.requestPermissionBtn = document.getElementById('requestPermissionBtn');
                this.startBtn = document.getElementById('startBtn');
                this.stopBtn = document.getElementById('stopBtn');
                this.minimizeBtn = document.getElementById('minimizeBtn');
                this.expandBtn = document.getElementById('expandBtn');
                this.miniStopBtn = document.getElementById('miniStopBtn');
                
                this.statusIndicator = document.getElementById('statusIndicator');
                this.screenPreview = document.getElementById('screenPreview');
                this.screenVideo = document.getElementById('screenVideo');
                this.solutionsContainer = document.getElementById('solutionsContainer');
                this.minimizedOverlay = document.getElementById('minimizedOverlay');
                
                this.captureIntervalInput = document.getElementById('captureInterval');
                this.outputPlatform = document.getElementById('outputPlatform');
                this.notificationEmail = document.getElementById('notificationEmail');
            }

            setupEventListeners() {
                this.requestPermissionBtn.addEventListener('click', () => this.requestScreenPermission());
                this.startBtn.addEventListener('click', () => this.startCapture());
                this.stopBtn.addEventListener('click', () => this.stopCapture());
                this.minimizeBtn.addEventListener('click', () => this.minimizeInterface());
                this.expandBtn.addEventListener('click', () => this.expandInterface());
                this.miniStopBtn.addEventListener('click', () => this.stopCapture());
                
                // Handle page visibility change for background operation
                document.addEventListener('visibilitychange', () => this.handleVisibilityChange());
                
                // Handle page before unload
                window.addEventListener('beforeunload', (e) => {
                    if (this.isCapturing) {
                        e.preventDefault();
                        e.returnValue = '';
                        return 'Screen capture is running. Are you sure you want to leave?';
                    }
                });
            }

            detectDevice() {
                const deviceIndicator = document.getElementById('deviceIndicator');
                const userAgent = navigator.userAgent.toLowerCase();
                
                if (userAgent.includes('mobile') || userAgent.includes('android') || userAgent.includes('iphone')) {
                    deviceIndicator.textContent = '📱 Mobile Device Detected';
                } else if (userAgent.includes('tablet') || userAgent.includes('ipad')) {
                    deviceIndicator.textContent = '📱 Tablet Device Detected';
                } else {
                    deviceIndicator.textContent = '💻 Desktop/Laptop Detected';
                }
            }

            generateDeviceId() {
                const deviceId = 'device_' + Math.random().toString(36).substr(2, 9);
                const deviceLink = document.getElementById('deviceLink');
                deviceLink.textContent = `https://solver.app/device/${deviceId}`;
            }

            async requestScreenPermission() {
                try {
                    this.stream = await navigator.mediaDevices.getDisplayMedia({
                        video: {
                            mediaSource: 'screen',
                            width: { ideal: 1920 },
                            height: { ideal: 1080 }
                        },
                        audio: false
                    });

                    this.screenVideo.srcObject = this.stream;
                    this.screenVideo.style.display = 'block';
                    this.screenPreview.style.display = 'none';

                    this.updateStatus('✅ Screen access granted - Ready to start', 'status-inactive');
                    this.startBtn.disabled = false;
                    this.requestPermissionBtn.style.display = 'none';

                    // Set up canvas dimensions
                    this.screenVideo.onloadedmetadata = () => {
                        this.canvas.width = this.screenVideo.videoWidth;
                        this.canvas.height = this.screenVideo.videoHeight;
                    };

                    this.showNotification('Screen access granted successfully!');

                } catch (error) {
                    this.updateStatus('❌ Screen access denied - ' + error.message, 'status-inactive');
                    console.error('Error accessing screen:', error);
                }
            }

            startCapture() {
                if (!this.stream || this.isCapturing) return;

                this.isCapturing = true;
                const interval = parseInt(this.captureIntervalInput.value) * 1000 || 2000;

                this.startBtn.style.display = 'none';
                this.stopBtn.style.display = 'inline-block';
                this.minimizeBtn.style.display = 'inline-block';

                this.updateStatus('🔍 Background capture active...', 'status-background');

                // Start continuous capture
                this.captureAndAnalyze();
                this.captureInterval = setInterval(() => {
                    this.captureAndAnalyze();
                }, interval);

                this.showNotification('Background screen capture started!');
            }

            stopCapture() {
                if (!this.isCapturing) return;

                this.isCapturing = false;
                
                if (this.captureInterval) {
                    clearInterval(this.captureInterval);
                    this.captureInterval = null;
                }

                if (this.stream) {
                    this.stream.getTracks().forEach(track => track.stop());
                    this.stream = null;
                }

                this.startBtn.style.display = 'inline-block';
                this.stopBtn.style.display = 'none';
                this.minimizeBtn.style.display = 'none';

                this.updateStatus('⏹️ Capture stopped', 'status-inactive');
                this.expandInterface();

                this.showNotification('Screen capture stopped');
            }

            async captureAndAnalyze() {
                if (!this.isCapturing || !this.stream) return;

                try {
                    // Capture current frame
                    this.ctx.drawImage(this.screenVideo, 0, 0, this.canvas.width, this.canvas.height);
                    const imageData = this.canvas.toDataURL('image/jpeg', 0.8);

                    // Simulate OCR and analysis
                    const detectedText = await this.simulateOCR(imageData);
                    
                    if (detectedText && this.isQuestion(detectedText)) {
                        this.questionsFound++;
                        this.updateStats();
                        
                        const solution = await this.solveQuestion(detectedText);
                        await this.sendSolution(detectedText, solution);
                        
                        this.solutionsSent++;
                        this.updateStats();
                    }

                } catch (error) {
                    console.error('Capture analysis error:', error);
                }
            }

            async simulateOCR(imageData) {
                // Simulate processing delay
                await new Promise(resolve => setTimeout(resolve, 300));
                
                const questions = [
                    "What is the integral of x² dx?",
                    "Solve: 3x + 7 = 22",
                    "Calculate 15% of 280",
                    "Convert 100°F to Celsius",
                    "What is the area of a triangle with base 8 and height 6?",
                    "Find the derivative of sin(x)",
                    "Solve: x² - 5x + 6 = 0",
                    "What is log₂(32)?",
                    "Calculate the circumference of a circle with radius 5",
                    "Simplify: (2x + 3)(x - 4)"
                ];
                
                // Randomly detect questions based on sensitivity
                const sensitivity = document.getElementById('sensitivity').value;
                let probability = sensitivity === 'high' ? 0.8 : sensitivity === 'medium' ? 0.4 : 0.2;
                
                if (Math.random() < probability) {
                    return questions[Math.floor(Math.random() * questions.length)];
                }
                
                return null;
            }

            isQuestion(text) {
                const questionWords = ['what', 'how', 'solve', 'calculate', 'find', 'convert', 'simplify'];
                const mathSymbols = ['=', '+', '-', '×', '÷', '²', '∫', 'd/dx'];
                
                const lowerText = text.toLowerCase();
                return questionWords.some(word => lowerText.includes(word)) ||
                       mathSymbols.some(symbol => text.includes(symbol)) ||
                       text.includes('?');
            }

            async solveQuestion(question) {
                await new Promise(resolve => setTimeout(resolve, 800));
                
                const lowerQ = question.toLowerCase();
                
                if (lowerQ.includes('integral') && lowerQ.includes('x²')) {
                    return "∫ x² dx = (x³/3) + C\n\nUsing the power rule for integration:\n∫ xⁿ dx = xⁿ⁺¹/(n+1) + C";
                }
                
                if (lowerQ.includes('3x + 7 = 22')) {
                    return "x = 5\n\nSolution:\n3x + 7 = 22\n3x = 22 - 7\n3x = 15\nx = 15/3 = 5";
                }
                
                if (lowerQ.includes('15%') && lowerQ.includes('280')) {
                    return "15% of 280 = 42\n\nCalculation: 280 × 0.15 = 42";
                }
                
                if (lowerQ.includes('100°f') && lowerQ.includes('celsius')) {
                    return "100°F = 37.78°C\n\nFormula: °C = (°F - 32) × 5/9\n°C = (100 - 32) × 5/9 = 37.78°C";
                }
                
                if (lowerQ.includes('area') && lowerQ.includes('triangle') && lowerQ.includes('8') && lowerQ.includes('6')) {
                    return "Area = 24 square units\n\nFormula: Area = (1/2) × base × height\nArea = (1/2) × 8 × 6 = 24";
                }
                
                if (lowerQ.includes('derivative') && lowerQ.includes('sin(x)')) {
                    return "d/dx[sin(x)] = cos(x)\n\nThe derivative of sine function is cosine function";
                }
                
                if (lowerQ.includes('x² - 5x + 6 = 0')) {
                    return "x = 2 or x = 3\n\nSolution by factoring:\nx² - 5x + 6 = 0\n(x - 2)(x - 3) = 0\nTherefore: x = 2 or x = 3";
                }
                
                if (lowerQ.includes('log₂(32)') || lowerQ.includes('log2(32)')) {
                    return "log₂(32) = 5\n\nBecause 2⁵ = 32\nSo log₂(32) = 5";
                }
                
                if (lowerQ.includes('circumference') && lowerQ.includes('radius 5')) {
                    return "Circumference = 31.42 units\n\nFormula: C = 2πr\nC = 2π × 5 = 10π ≈ 31.42";
                }
                
                if (lowerQ.includes('(2x + 3)(x - 4)')) {
                    return "2x² - 5x - 12\n\nExpansion:\n(2x + 3)(x - 4) = 2x² - 8x + 3x - 12 = 2x² - 5x - 12";
                }
                
                return `Solution detected for: "${question}"\n\nThis appears to be a valid question. In a full implementation, this would be solved using advanced AI.`;
            }

            async sendSolution(question, solution) {
                const platform = this.outputPlatform.value;
                const timestamp = new Date().toLocaleTimeString();
                
                // Display solution locally
                this.displaySolution(question, solution, timestamp, platform);
                
                // Simulate sending to different platforms
                switch (platform) {
                    case 'phone':
                        await this.sendToMobile(question, solution);
                        break;
                    case 'email':
                        await this.sendToEmail(question, solution);
                        break;
                    case 'discord':
                        await this.sendToDiscord(question, solution);
                        break;
                    case 'slack':
                        await this.sendToSlack(question, solution);
                        break;
                }
                
                // Show notification
                if (this.isMinimized) {
                    this.showNotification(`New solution sent to ${platform}!`);
                }
            }

            async sendToMobile(question, solution) {
                // Simulate mobile push notification
                console.log('📱 Sending to mobile:', { question, solution });
                
                // In real implementation, this would use:
                // - Firebase Cloud Messaging
                // - Apple Push Notification Service
                // - WebSocket connection to mobile app
            }

            async sendToEmail(question, solution) {
                const email = this.notificationEmail.value;
                if (!email) return;
                
                console.log('📧 Sending email to:', email, { question, solution });
                
                // In real implementation, this would use:
                // - EmailJS
                // - SendGrid API
                // - Backend email service
            }

            async sendToDiscord(question, solution) {
                console.log('💬 Sending to Discord:', { question, solution });
                
                // In real implementation, this would use:
                // - Discord webhook
                // - Discord bot API
            }

            async sendToSlack(question, solution) {
                console.log('💬 Sending to Slack:', { question, solution });
                
                // In real implementation, this would use:
                // - Slack webhook
                // - Slack API
            }

            displaySolution(question, solution, timestamp, platform) {
                const solutionDiv = document.createElement('div');
                solutionDiv.className = 'solution-item';
                
                const platformIcon = {
                    'phone': '📱',
                    'tablet': '📱',
                    'email': '📧',
                    'discord': '💬',
                    'slack': '💬'
                }[platform] || '📱';
                
                solutionDiv.innerHTML = `
                    <div class="solution-header">
                        <div class="timestamp">🕐 ${timestamp}</div>
                        <div class="device-tag">${platformIcon} Sent to ${platform}</div>
                    </div>
                    <div class="detected-question">
                        <strong>🔍 Detected Question:</strong><br>
                        ${question}
                    </div>
                    <div class="solution-content">
                        <strong>💡 Solution:</strong><br>
                        ${solution.replace(/\n/g, '<br>')}
                    </div>
                `;
                
                this.solutionsContainer.insertBefore(solutionDiv, this.solutionsContainer.firstChild);
                
                // Keep only last 15 solutions
                while (this.solutionsContainer.children.length > 16) { // +1 for the placeholder text
                    this.solutionsContainer.removeChild(this.solutionsContainer.lastChild);
                }
                
                // Remove placeholder text if it exists
                const placeholder = this.solutionsContainer.querySelector('p');
                if (placeholder && placeholder.textContent.includes('Solutions will appear here')) {
                    placeholder.remove();
                }
            }

            updateStats() {
                document.getElementById('questionsFound').textContent = this.questionsFound;
                document.getElementById('solutionsSent').textContent = this.solutionsSent;
            }

            minimizeInterface() {
                this.isMinimized = true;
                document.querySelector('.container').style.display = 'none';
                this.minimizedOverlay.style.display = 'block';
                
                document.getElementById('miniStatus').textContent = 
                    this.isCapturing ? '🔍 Running in background...' : '💤 Paused';
            }

            expandInterface() {
                this.isMinimized = false;
                document.querySelector('.container').style.display = 'block';
                this.minimizedOverlay.style.display = 'none';
            }

            updateStatus(message, className = 'status-inactive') {
                this.statusIndicator.textContent = message;
                this.statusIndicator.className = `status-indicator ${className}`;
                
                if (this.isMinimized) {
                    document.getElementById('miniStatus').textContent = message;
                    document.getElementById('miniStatus').className = `status-indicator ${className}`;
                }
            }

            handleVisibilityChange() {
                if (document.hidden && this.isCapturing) {
                    // Page is hidden but capture should continue
                    console.log('🔍 Continuing background capture while page is hidden');
                } else if (!document.hidden && this.isCapturing) {
                    console.log('🔍 Page visible, capture continuing');
                }
            }

            showNotification(message) {
                const notification = document.createElement('div');
                notification.className = 'notification';
                notification.textContent = message;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.opacity = '0';
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 500);
                }, 3000);
            }
        }

        // Service Worker Registration for Background Operation
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:application/javascript;base64,' + btoa(`
                self.addEventListener('message', function(event) {
                    if (event.data && event.data.type === 'KEEP_ALIVE') {
                        // Keep service worker alive
                        console.log('Service worker keeping alive for background capture');
                    }
                });
                
                self.addEventListener('notificationclick', function(event) {
                    event.notification.close();
                    
                    event.waitUntil(
                        clients.openWindow('/')
                    );
                });
            `)).then(function(registration) {
                console.log('🔧 Service Worker registered for background operation');
                
                // Send keep-alive messages
                setInterval(() => {
                    if (navigator.serviceWorker.controller) {
                        navigator.serviceWorker.controller.postMessage({
                            type: 'KEEP_ALIVE'
                        });
                    }
                }, 30000); // Every 30 seconds
                
            }).catch(function(error) {
                console.log('❌ Service Worker registration failed:', error);
            });
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            window.screenSolver = new CrossDeviceScreenSolver();
            
            // Request notification permission
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        console.log('🔔 Notification permission granted');
                    }
                });
            }
            
            // Prevent accidental page close
            window.addEventListener('beforeunload', function(e) {
                if (window.screenSolver && window.screenSolver.isCapturing) {
                    e.preventDefault();
                    e.returnValue = 'Screen capture is active. Are you sure you want to leave?';
                    return e.returnValue;
                }
            });
        });

        // Add keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + Shift + S to start/stop
            if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'S') {
                e.preventDefault();
                if (window.screenSolver) {
                    if (window.screenSolver.isCapturing) {
                        window.screenSolver.stopCapture();
                    } else {
                        window.screenSolver.startCapture();
                    }
                }
            }
            
            // Ctrl/Cmd + Shift + M to minimize/expand
            if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'M') {
                e.preventDefault();
                if (window.screenSolver) {
                    if (window.screenSolver.isMinimized) {
                        window.screenSolver.expandInterface();
                    } else {
                        window.screenSolver.minimizeInterface();
                    }
                }
            }
        });

        // Add visual feedback for active capture areas
        function highlightCapturedArea() {
            if (window.screenSolver && window.screenSolver.isCapturing) {
                // Add subtle overlay to indicate active capture
                if (!document.querySelector('.capture-indicator')) {
                    const indicator = document.createElement('div');
                    indicator.className = 'capture-indicator';
                    indicator.style.cssText = `
                        position: fixed;
                        top: 0;
                        left: 0;
                        right: 0;
                        height: 3px;
                        background: linear-gradient(90deg, #4CAF50, #2196F3, #4CAF50);
                        background-size: 200% 100%;
                        animation: captureAnimation 2s linear infinite;
                        z-index: 9999;
                        pointer-events: none;
                    `;
                    
                    // Add animation
                    const style = document.createElement('style');
                    style.textContent = `
                        @keyframes captureAnimation {
                            0% { background-position: 200% 0; }
                            100% { background-position: -200% 0; }
                        }
                    `;
                    document.head.appendChild(style);
                    document.body.appendChild(indicator);
                }
            } else {
                // Remove indicator when not capturing
                const indicator = document.querySelector('.capture-indicator');
                if (indicator) {
                    indicator.remove();
                }
            }
        }

        // Update capture indicator every second
        setInterval(highlightCapturedArea, 1000);
    </script>
</body>
</html>